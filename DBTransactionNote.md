# 数据库事务管理

**事务:**	一组SQL语句组成的一个单元，该单元里的SQL语句要么要不执行，要么不一起执行。如果在执行该单元时发生异常，那么该事务会发生回滚，即事务状态会回滚到最初始状态。



## 事务的ACID属性

**A：Automicity 原子性**

原子性是指事务是最小的单元，不能再分割。



**C: Consistency 一致性**

事务必须使数据库从一个一致性状态变换到另一个一致性状态。

比如:转账案例，A用户和B用户分别有存款200元，那么此时总金额为400元。当A用户转账给B用户100元，此时A用户账户剩余100元，B用户账户300元，那么总金额还是400元不变。



**I:Isolation 隔离性**

事务与事务之间是不能相互依赖，而是独立存在。即对一个事务操作不会影响到另一个事务。



**D:Durability 持久性**

当事务提交后，那么对数据库的改变是永久的。



## **数据库的隔离级别:**

如果执行多个事务，并且访问的是相同的数据库，且不了解数据库隔离级别的话，可能会引发问题。

**引发的问题:**

**1.脏读** : 假设有两个事务T1和T2. T2更新了字段内容但是还未提交，此时T1就读取了更新后字段的内容，那么如果T2事务发生回滚，那么T1读取的字段是无效的。

**2.不可重复度**: 假设有两个事务T1和T2. T1读取了一个字段，然后T2更新了该字段，那么下次再读取同一个字段，值就会发生变化。

**3.幻读:** 假设有两个事务T1和T2，T1读取了该字段内容(3行)，然后T2插入了2行内容，那么下次再读取该字段内容是会显示5行内容。



我们可以通过设置数据库隔离级别来防止以上的问题:

**Read uncommitted(读取未提交):** 允许事务可以读取未被其他事务提交的内容。

**Read commitedd(读取已提交):** 允许事务可以读取已经被其他事务提交的内容。 防止脏读

**Repeatable Read(可重复读):** 确保事务可以多次重同一个字段中读取相同的值，在此期间，禁止其他事务对此字段进行更新。解决的脏读，不可重复读。

**Serializable(串行化):** 确保事务在表中可以读取相同内容，在此期间，禁止其他事务对该表进行插入操作。解决了脏读，不可重复度，幻读。

注:Oracle 默认支持事务隔离级别为 read committed。 MySQL默认支持的事务隔离级别为Repeatable Read.

